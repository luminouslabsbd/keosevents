{% extends "Global/layout.html.twig" %}

{% set pagetitle = 'Zoom SDK' | trans %}

{% block title %}{{ pagetitle }}{% endblock %}

{% block stylesheets %}
    <style>
        html,
        body {
            min-width: 0 !important;
            font-size: 13px !important;
        }

        #zmmtg-root {
            display: none;
            min-width: 0 !important;
        }

        .main {
            width: 70%;
            margin: auto;
            text-align: center;
        }

        .join-button {
            margin-top: 20px;
            background-color: #2D8CFF;
            color: #ffffff;
            text-decoration: none;
            padding: 10px 40px;
            display: inline-block;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            outline: none;
        }

        .join-button:hover {
            background-color: #2681F2;
        }
        .section-pagetop{
            padding:2px 0 !important;
        }
        .breadcrumb{
            padding: 0 15px !important;
        }
        .root-inner{
            background-color:red;
       }

       .start-quiz-icon{
            padding: 10px 20px;
            background-color: #ab5512;
            color: white;
            border-radius: 10px;
       }
       .start-quiz-heading {
            font-size: 25px;
            text-align: center;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            justify-content: center;
            margin: auto;
            padding-left: 158px;
            color: #033c03d1;
            font-weight: 600;
        }
        .start-quiz-row-parent .col-lg-6.col-12 {
            margin: 0;
            padding: 0px 2px;
        }

        h1.start-quiz-icon i{
            text-align: center;
            display: flex;
            justify-content: center;
            font-size: 25px;
        }

        .modal-footer button.btn.btn-secondary {
            background-color: #40e3eb;
            color: #585656;
            font-weight: 600;
            padding: 10px 30px;
            border-radius: 25px;
            outline: none;
            border: none;
            text-transform: capitalize;
        }

        .btn-secondary.focus, .btn-secondary:focus{
            box-shadow: none;
        }

        .modal-body{
            padding: 10px !important;
        }

        .modal-content{
            border: 7px solid #97a89bc7 !important;
        }

        .modal-content.show-result-modal-inner{
            background-color: #d8edca !important; 
        }

        button.btn.btn-praimary.show-result-modal-button {
            background-color: #17589b;
            color: white;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: auto;
            margin-bottom: 40px;
        }

        .show-result-heading{
            text-align: center;
        }

        .modal-content.show-winner-inner{
            background-color: #d8edca !important; 
        }

        .modal-title.winner-title{
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: auto;
            padding-left: 180px;
            font-size: 24px;
            font-weight: 600;
        }

        h1.winner-title {
            text-align: center;
            font-size: 20px;
            margin-bottom: 45px;
        }

        .winner-number-parent {
            height: 40px;
            width: 50px;
            margin: auto;
            background-color: #838f78;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }

        .winner-paragraph{
            text-align: center;
        }

        .quick-links-fream iframe{
            width: 100%;
            height: 675px !important;
        }

        .inner-quize-modal-xl{
            max-width: 1320px !important;
            width: 100% !important;
            height: 800px !important;
        }

        .inner-quize-modal-xl .modal-content{
            width: 100% !important;
            max-width: 1320px !important;
            height: 800px !important;
            margin-top: 400px;
            border-radius: 10px;
        }

        .modal-header .close{
            color: black;
            opacity: 1;
        }

        .modal_minimize_icon {
            padding-top: 9px !important;
            border: 1px solid #ddd !important;
        }
        .modal_minimize_icon i{
            font-size:16px;
        }
        .modal_close_icon {
            border: 1px solid #ddd !important;
            height: 44px !important;
            margin-left:15px !important;
        }
    </style>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

    <style type="text/css">  

        .modal-header .btnGrp{
            position: absolute;
            top: 8px;
            right: 10px;
        } 
    

        .min{
            width: 250px; 
            height: 35px;
            overflow: hidden !important;
            padding: 0px !important;
            margin: 0px;    

            float: left;  
            position: static !important; 
        }

        .min .modal-dialog, .min .modal-content{
            height: 100%;
            width: 100%;
            margin: 0px !important;
            padding: 0px !important; 
        }

        .min .modal-header{
            height: 100%;
            width: 100%;
            margin: 0px !important;
            padding: 3px 5px !important; 
        }

        .display-none{display: none;}

        button .fa{
            font-size: 16px;
            margin-left: 10px;
        }

        .min .fa{
            font-size: 14px; 
        }

        .min .menuTab{display: none;}

        button:focus { outline: none; }

        .minmaxCon{
            height: 35px;
            bottom: 1px;
            left: 1px;
            position: fixed;
            right: 1px;
            z-index: 9999;
        }
    </style> 
{% endblock %}

{% block content %}



    {% set navigation = [{"dashboard_index": "Dashboard"|trans,"current":(pagetitle)}] %}
    {% include "Global/navigation.html.twig" with navigation %}

    <section class="section-content padding-y bg-white">
        <div class="{{ services.getSetting("app_layout") }}">
            <div class="row">
                <div class="col-lg-12 mt-4 mt-lg-0">
                    <div class="card shadow padding-bottom-lg">
                        <div class="main">
                            <h1>Zoom Meeting SDK</h1>

                            <!-- For Component View -->
                            <div id="meetingSDKElement">
                                <!-- Zoom Meeting SDK Rendered Here -->
                            </div>

                            <button class="join-button" onClick="getSignature()">Join Meeting</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    {# quiz modals #}
    <!-- quiz start Modal -->
    {# <div class="modal fade" id="quiz_start_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog  modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title start-quiz-heading" id="exampleModalLongTitle">How Many People live in Tuvalu ?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row start-quiz-row-parent">
                    <div class="col-lg-6 col-12">
                        <h1 class="start-quiz-icon"><i class="fas fa-exclamation-triangle"></i></h1>
                    </div>

                    <div class="col-lg-6 col-12">
                        <h1 class="start-quiz-icon"><i class="fas fa-cog"></i></h1>
                    </div>

                    <div class="col-lg-6 col-12">
                        <h1 class="start-quiz-icon"><i class="fas fa-exclamation-triangle"></i></h1>
                    </div>
                    
                    <div class="col-lg-6 col-12">
                        <h1 class="start-quiz-icon"><i class="fas fa-cog"></i></h1>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Sand</button>
            </div>
            </div>
        </div>
    </div> #}

     <!-- show result Modal -->
    {# <div class="modal fade" id="show_result_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg  modal-dialog-centered" role="document">
            <div class="modal-content show-result-modal-inner">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            <button class="btn btn-praimary show-result-modal-button">Export Result</button>
            <h1 class="show-result-heading">1: Mawoka with 136 points</h1>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
            </div>
        </div>
    </div> #}

     <!-- show winner Modal -->
    {# <div class="modal fade" id="show_winner_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
             <div class="modal-content show-winner-inner">
            <div class="modal-header">
                <h5 class="modal-title winner-title" id="exampleModalLongTitle">Result</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="winner-number-parent">+136</div>
                <p class="winner-paragraph">Totle Score: 136</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
            </div>
        </div>
    </div> #}



    <div class="modal fade mymodal" data-keyboard="false" data-backdrop="static"  id="quiz_start_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog  modal-lg inner-quize-modal-xl modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title start-quiz-heading" id="exampleModalLongTitle">Quiz demo</h5>

                    {# <button type="button" class="modal_minimize_icon modalMinimize">
                        <i class='fa fa-minus'></i>
                    </button> #}

                    <button type="button" class="close modal_close_icon" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row start-quiz-row-parent quick-links-fream">
                        <iframe src="{{ quizApiUrl }}" height="200" width="300"  title="quiz"></iframe> 
                    </div>
                </div>
            
            </div>
        </div>
    </div>

    <div class="minmaxCon"></div>  


    

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    {# <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script> #}
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>

    <!-- Dependencies for client view and component view -->
    <script src="https://source.zoom.us/3.1.6/lib/vendor/react.min.js"></script>
    <script src="https://source.zoom.us/3.1.6/lib/vendor/react-dom.min.js"></script>
    <script src="https://source.zoom.us/3.1.6/lib/vendor/redux.min.js"></script>
    <script src="https://source.zoom.us/3.1.6/lib/vendor/redux-thunk.min.js"></script>
    <script src="https://source.zoom.us/3.1.6/lib/vendor/lodash.min.js"></script>

    <!-- For Client View -->
    <script src="https://source.zoom.us/zoom-meeting-3.1.6.min.js"></script>
    <script>
        ZoomMtg.preLoadWasm()
        ZoomMtg.prepareWebSDK()

        var authEndpoint = 'https://zoom.keosapp.com'
        var sdkKey = 'bKhbgbAOR_CwOiOkBQOK0Q'
        var meetingNumber = '89219418793'
        var passWord = '12345678'
        var role = 0
        var userName = 'JavaScript'
        var userEmail = ''
        var registrantToken = ''
        var zakToken = ''
        var leaveUrl = 'https://zoom.us'

        function getSignature() {
            fetch(authEndpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    meetingNumber: meetingNumber,
                    role: role
                })
            }).then((response) => {
                return response.json()
            }).then((data) => {
                // console.log(data)
                startMeeting(data.signature)
            }).catch((error) => {
                // alert('SDK key Not Valid')
                console.log(error)
            })
        }

        function startMeeting(signature) {

            document.getElementById('zmmtg-root').style.display = 'block'

            ZoomMtg.init({
                leaveUrl: leaveUrl,
                patchJsMedia: true,
                success: (success) => {
                    console.log(success)
                    ZoomMtg.join({
                        signature: signature,
                        sdkKey: sdkKey,
                        meetingNumber: meetingNumber,
                        passWord: passWord,
                        userName: userName,
                        userEmail: userEmail,
                        // tk: registrantToken,
                        // zak: zakToken,
                        success: (success) => {
                            console.log(success)
                        },
                        error: (error) => {
                            console.log(error)
                        },
                    })
                },
                error: (error) => {
                    console.log(error)
                }
            })
        }
    </script>

    <!-- For Component View -->
    <!-- <script src="https://source.zoom.us/3.1.6/zoom-meeting-embedded-3.1.6.min.js"></script>
    <script type="text/javascript" src="component-view.js"></script> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
    <script>
        var socket = io("{{ nodeServer }}", {
            secure: true,
        })
        socket.on("start_quiz_", function(response) {
            $('#quiz_start_modal').modal('show');
        });

        socket.on("close_quiz_", function(response) {
            $('#quiz_start_modal').modal('hide');
        });
    </script>

    <script>
        $(document).ready(function(){ 
            var $content, $modal, $apnData, $modalCon; 
            $content = $(".min");

            $(".modalMinimize").on("click", function(){
                $modalCon = $(this).closest(".mymodal").attr("id");  
                $apnData = $(this).closest(".mymodal");
                $modal = "#" + $modalCon;
                $(".modal-backdrop").addClass("display-none");

                $($modal).toggleClass("min");
                if ( $($modal).hasClass("min") ){ 
                    $(".minmaxCon").append($apnData);  
                    $(this).find("i").toggleClass('fa-minus fa-clone');
                } 
                else { 
                    $(".container").append($apnData); 
                    $(this).find("i").toggleClass('fa-clone fa-minus');
                };
            });

            $("button[data-dismiss='modal']").click(function(){   
                var $modal = $(this).closest(".mymodal");
                $modal.removeClass("min");
                $(".container").append($modal);   
                $modal.find(".modalMinimize i").removeClass('fa-clone').addClass('fa-minus');
            }); 
        });
    </script>
    

{% endblock %}